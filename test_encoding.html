<!DOCTYPE html>
<html>
<head>
    <title>SVG Encoding Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .svg-container { border: 1px solid #ddd; margin: 10px 0; }
        .error { color: red; background: #ffebee; padding: 10px; }
        .success { color: green; background: #e8f5e8; padding: 10px; }
    </style>
</head>
<body>
    <h1>SVG Visualization Encoding Test</h1>
    
    <div class="test-case">
        <h3>Test 1: Basic Lean Code</h3>
        <p>Testing: theorem square_nonneg (x : ℝ) : x^2 ≥ 0</p>
        <div id="test1-result" class="svg-container"></div>
    </div>

    <div class="test-case">
        <h3>Test 2: Unicode Characters</h3>
        <p>Testing: ∀ x ∈ ℝ, α + β = γ</p>
        <div id="test2-result" class="svg-container"></div>
    </div>

    <div class="test-case">
        <h3>Test 3: Special Characters</h3>
        <p>Testing: "quotes" & &lt;tags&gt;</p>
        <div id="test3-result" class="svg-container"></div>
    </div>

    <script>
        // Simple visualization function (inline for testing)
        function generateTestSVG(title, content) {
            return `<svg width="600" height="300" xmlns="http://www.w3.org/2000/svg">
                <rect width="600" height="300" fill="#f8f9fa" stroke="#dee2e6"/>
                <text x="300" y="50" text-anchor="middle" font-size="16" font-weight="bold">${title}</text>
                <text x="300" y="150" text-anchor="middle" font-size="12">${content}</text>
                <text x="300" y="250" text-anchor="middle" font-size="10" fill="#666">Generated: ${new Date().toLocaleTimeString()}</text>
            </svg>`;
        }

        function testSVGEncoding(svgString, containerId) {
            const container = document.getElementById(containerId);
            
            try {
                // Test encoding
                const encoded = btoa(unescape(encodeURIComponent(svgString)));
                console.log(`Encoded length: ${encoded.length}`);
                
                // Test decoding
                const decoded = decodeURIComponent(escape(atob(encoded)));
                console.log(`Decoded successfully`);
                
                // Display the SVG
                container.innerHTML = decoded;
                container.style.backgroundColor = '#e8f5e8';
                
                // Add success message
                const msg = document.createElement('div');
                msg.className = 'success';
                msg.textContent = '✅ Encoding/Decoding successful';
                container.parentNode.insertBefore(msg, container.nextSibling);
                
            } catch (error) {
                console.error(`Error with ${containerId}:`, error);
                container.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }

        // Run tests
        document.addEventListener('DOMContentLoaded', function() {
            const tests = [
                {
                    id: 'test1-result',
                    title: 'Lean Theorem Visualization',
                    content: 'theorem square_nonneg (x : ℝ) : x^2 ≥ 0 := by sorry'
                },
                {
                    id: 'test2-result', 
                    title: 'Unicode Test: ∀ x ∈ ℝ',
                    content: 'α + β = γ (unicode characters)'
                },
                {
                    id: 'test3-result',
                    title: 'Special Characters Test',
                    content: '"quotes" & <tags> & ampersands'
                }
            ];

            tests.forEach(test => {
                const svg = generateTestSVG(test.title, test.content);
                testSVGEncoding(svg, test.id);
            });
        });
    </script>
</body>
</html>
